# 项目快照_2025-12-06_1702

1. **项目背景**  
   课程资料管理桌面端，前后端已联通，界面与交互完成约 80%，当前重点是布局梳理与提示样式优化。

2. **负责的板块**  
   前端（Vue3 + Vite + TS，pywebview 桥接后端）。

3. **技术选型**  
   
   - 前端：TypeScript · Vue 3 · Vite · npm  
     开发：`cd web && npm install && npm run dev`  
     构建：`npm run build`  
   - 后端：Python · FastAPI · Tortoise ORM（SQLite）  
     运行：`pip install -r requirements.txt && uvicorn app.main:app --reload`  
   - 桌面：pywebview（`app/desktop/bridge.py`）

4. **仓库结构（概览）**  
   
   - `app/`（后端与桌面桥接；routers、models、desktop/bridge.py）  
   - `web/`（前端工程）  
     - `src/components/anchors/`（AnchorTable、AnchorDetail）  
     - `src/components/layout/`（FolderTree、FolderTabs、TagManager、TopMenu）  
     - `src/components/icons/`（folder/recycle/library 等 SVG）  
     - `src/types/ui.ts`（前端类型定义）  
     - `src/views/HomeView.vue`（主界面）  
   - `PROJECT_SNAPSHOT.md`（旧说明），`项目快照_2025-12-06_1702.md`（本文件）

5. **已实现功能（最小片段）**
   
   <details>
   <summary>file:web/src/views/HomeView.vue · 确认/信息对话框状态与弹窗</summary>
   
   ```ts
   const confirmState = ref({ open: false, title: '', description: '', onConfirm: null as (() => Promise<void>) | null })
   const infoState = ref({ open: false, title: '', description: '' })
   ```
   
   ```vue
   <Dialog v-model:open="confirmState.open">
     <DialogContent class="sm:max-w-[420px]">
       <DialogHeader>
         <DialogTitle>{{ confirmState.title }}</DialogTitle>
         <DialogDescription>{{ confirmState.description }}</DialogDescription>
       </DialogHeader>
       <DialogFooter class="mt-4 flex justify-end gap-2">
         <button @click="handleConfirmCancel">取消</button>
         <button @click="handleConfirmOk">确认</button>
       </DialogFooter>
     </DialogContent>
   </Dialog>
   ```
   
   </details>
   
   <details>
   <summary>file:web/src/components/layout/FolderTabs.vue · 已打开文件夹标签（紧凑样式）</summary>
   
   ```vue
   <div class="flex items-center gap-2 border-b bg-[#f2f2f2] px-4 py-1.5 overflow-hidden">
     <div class="no-scrollbar flex flex-1 items-center gap-2 overflow-x-auto h-8">
       <div v-for="folder in openFolders" :key="folder.id"
            class="flex items-center gap-1.5 rounded-lg border px-2.5 py-1.5 text-[13px] h-8"
            :class="folder.id===activeFolderId ? 'border-blue-400 bg-blue-50 text-blue-800' : 'border-slate-200 bg-white text-slate-800'">
         <button class="flex min-w-0 flex-1 items-center gap-1.5" @click="emit('select', folder.id)">
           <img class="h-3.5 w-3.5" :src="folder.icon==='recycle'?recycleIcon:folder.icon==='library'?libraryIcon:folderIcon" />
           <span class="truncate">{{ folder.name }}</span>
         </button>
         <button class="shrink-0 rounded-md px-1.5 py-0.5 text-sm hover:bg-red-100 hover:text-red-600 cursor-pointer">×</button>
       </div>
     </div>
   </div>
   ```
   
   </details>
   
   <details>
   <summary>file:app/desktop/bridge.py · 打开文件</summary>
   
   ```py
   def open_file(self, path: str) -> dict[str, Any]:
       if not path: return {"success": False, "error": "empty_path"}
       p = Path(path).expanduser()
       if not p.exists(): return {"success": False, "error": "not_found"}
       if not p.is_file(): return {"success": False, "error": "not_file"}
       try:
           if sys.platform.startswith("win"): os.startfile(p)
           elif sys.platform == "darwin": subprocess.Popen(["open", str(p)])
           else: subprocess.Popen(["xdg-open", str(p)])
           return {"success": True}
       except Exception as exc:
           return {"success": False, "error": str(exc)}
   ```
   
   </details>

6. **待办清单**

| 任务                               | 目标文件                       | 验收标准                                                      |
| -------------------------------- | -------------------------- | --------------------------------------------------------- |
| 主布局左/右分栏梳理（右侧 FunctionMenu 独立一列） | web/src/views/HomeView.vue | 左侧包含顶部标签+树+标签栏+锚点表+详情，右侧为 FunctionMenu；`npm run build` 通过 |
| 清空回收站/文案确认乱码回查                   | web/src/views/HomeView.vue | 中文文案正常显示                                                  |
| TopMenu/FunctionMenu 文件取舍        | web/src/components/layout  | 确认实际使用的组件，移除未用项或更新导入                                      |

7. **注意事项**
   
   - HomeView 已从 git 恢复，确保本次调整基于当前干净版本；建议改前先再做一次备份。  
   - 前端 Node ≥18；常用命令：`npm run dev` / `npm run build`。  
   - 后端启动前确认 SQLite 数据文件存在或由迁移生成；`uvicorn app.main:app --reload`。  
   - 构建输出到 `webdist/`（在项目根外层），需要清空请加 `--emptyOutDir`。

8. **关键对话摘要（倒序）**
   
   - 2025-12-06：用户已 git 恢复，要求保持左右分栏：左侧主区域 + 右侧 FunctionMenu 独立列。  
   - 2025-12-06：顶部已打开文件夹标签紧凑化，关闭按钮放大并增加 hover 提示。  
   - 2025-12-06：弹窗（确认/信息）统一改用 shadcn Dialog，替换原生 alert/confirm。  
   - 2025-12-06：创建虚拟文件夹避免重名 409，文件类型小写展示，拖拽提示、标签 hover 优化。
